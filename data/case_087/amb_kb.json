{
  "ambiguities": [
    {
      "id": "1_C1_qa_classification_rules",
      "kind": "Row-level concept",
      "node_id": "classify_qa",
      "op": "project",
      "source_text": "Every subsequent comment is either a question or answer",
      "ref": "def classify_comment(row):\n        if row[\"Is First Comment\"] or row[\"Is Carl First\"]:\n            return None\n        if row[\"Who\"] == \"Carl Allchin\":\n            return \"Answer\"\n        if \"@\" in str(row[\"Comment\"]):\n            return \"Answer\"\n        if \"?\" in str(row[\"Comment\"]):\n            return \"Question\"\n        return \"Answer\"\n\n    all_df[\"Question or Answer\"] = all_df.apply(classify_comment, axis=1)"
    },
    {
      "id": "2_O2_exclude_carl_opening_comment",
      "kind": "Operation incomplete",
      "node_id": "classify_qa",
      "op": "project",
      "intent": "Exclude Carl Allchin’s first comment in each session from question/answer classification and counts.",
      "ref": "all_df[\"Is Carl First\"] = (\n        (all_df[\"Who\"] == \"Carl Allchin\") &\n        (all_df.groupby([\"Location\", \"Who\"]).cumcount() == 0)\n    )\n\ndef classify_comment(row):\n        if row[\"Is First Comment\"] or row[\"Is Carl First\"]:\n            return None"
    },
    {
      "id": "3_C2_local_datetime_base_plus_offset",
      "kind": "Group-level concept",
      "node_id": "compute_local_dt",
      "op": "project",
      "intent": "Construct Local DateTime by adding the record Time value as an elapsed offset to 2020-10-07 14:00:00.",
      "ref": "base_date = datetime(2020, 10, 7, 14, 0, 0)\n\ndef parse_time(time_str):\n        parts = time_str.split(\":\")\n        hours = int(parts[0])\n        minutes = int(parts[1])\n        seconds = int(parts[2])\n        return base_date + timedelta(hours=hours, minutes=minutes, seconds=seconds)\n\nall_df[\"Local DateTime\"] = all_df[\"Time\"].apply(parse_time)"
    },
    {
      "id": "4_O1_first_comment_per_session_person",
      "kind": "Operation boundary",
      "node_id": "mark_seq",
      "op": "project",
      "source_text": "Everyone's first comment (except Carl Allchin's) is saying where they are from",
      "ref": "all_df[\"Is First Comment\"] = (\n        (all_df[\"Who\"] != \"Carl Allchin\") & \n        (all_df.groupby([\"Location\", \"Who\"]).cumcount() == 0)\n    )"
    },
    {
      "id": "5_C1_first_time_indicator_keyword",
      "kind": "Row-level concept",
      "node_id": "mark_seq",
      "op": "project",
      "source_text": "saying where they are from and whether it's their first session",
      "ref": "first_time = bool(re.search(r'first\\s+time', comment, re.IGNORECASE))"
    },
    {
      "id": "6_O1_sequence_order_by_gmt",
      "kind": "Single-table reference",
      "node_id": "sort_for_seq",
      "op": "sort",
      "intent": "Order comments by Date (GMT) ascending (within Location and Who) to determine each person’s comment sequence.",
      "ref": "all_df = all_df.sort_values([\"Location\", \"Who\", \"Date (GMT)\"])"
    }
  ]
}
